cyberark_identity_logs:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule:
    cronSchedule: "*/5 * * * *"
    maxConcurrentRuns: 1
    skippable: true
    run:
      rescheduleDroppedTasks: true
      maxTaskReschedule: 1
      logLevel: info
      jobTimeout: 60m
      mode: run
      timeRangeType: relative
      timeWarning: {}
      expression: "true"
      minTaskSize: 1MB
      maxTaskSize: 10MB
      stateTracking:
        stateUpdateExpression: WhenOccurred
        stateMergeExpression: "(state > value) ? state : value"
        enabled: true
    enabled: true
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: none
      collectMethod: post_with_body
      pagination:
        type: request_page
        pageField: page
        sizeField: page_size
        size: 50
        maxPages: 50
        zeroIndexed: false
        attribute:
          - Result.IsAggregate
        totalRecordField: Result.Count
        page: 0
      authentication: login
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: false
      rejectUnauthorized: true
      captureHeaders: false
      stopOnEmptyResults: true
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking:
          stateFileId: cyberark_audit_state
          jobAttribute: _last_collection_time
          initialValue: "'2026-01-01T00:00:00Z'"
          updateExpression: WhenOccurred
          mergeExpression: "(state > value) ? state : value"
      loginUrl: "'https://acf4417.id.cyberark.cloud/oauth2/token/cribl_identity_app'"
      loginBody: "`grant_type=client_credentials&scope=cribl&client_id=${C.Secret('Cy\
        berArk_API_Key',
        'keypair').apiKey}&client_secret=${C.Secret('CyberArk_API_Key',
        'keypair').secretKey}`"
      getAuthTokenFromHeader: false
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token.trim()}`"
      tokenRespAttribute: access_token
      collectUrl: "'https://acf4417.id.cyberark.cloud/Redrock/query'"
      collectBody: |-
        `{
          "Script": "Select * FROM Event WHERE WhenOccurred > '${(typeof _last_collection_time !== 'undefined' && _last_collection_time) ? _last_collection_time : '2025-01-01T00:00:00Z'}' ORDER BY WhenOccurred ASC",
          "args": {"PageNumber": ${(typeof page!=='undefined' && page) ? Number.parseInt(page) : 0}, "Limit": 100}
        }`
      collectRequestHeaders:
        - name: Content-Type
          value: "#42:1VJM0BiHRm6YxfjEwGmQCRniD8UPwZieESRjeWNoR62AZ5d7C+ksaEg93XkA8ORs"
        - name: X-IDAP-NATIVE-CLIENT
          value: "#42:IXSj9L0gmk5WwHj1lkMGmEPIPIG3+f4b99xtNc8+uwk="
      username: "#42:6wmQ0z7tjapRaFsFRitpRNKJqNKh+Jbg35YbGwiEBNE="
      password: "#42:y6M0XBOv+pKmP3sQBvqHbyxgedLIQ79MghpkByN7oRs="
      authRequestHeaders:
        - name: Content-Type
          value: "#42:WAZ/TtcawmG/24BI+aXjT3idkz++wXTO7QYzNBq7EZVnHUQW0sKgDjD9TN7AWeSN3x8\
            IrKuR5m5XhIVootujaQ=="
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - CyberArk_Audit
  savedState: {}
  notifications: []
cyberark_audit_logs:
  type: collection
  ttl: 4h
  ignoreGroupJobsLimit: false
  removeFields: []
  resumeOnBoot: false
  schedule: {}
  streamtags: []
  workerAffinity: false
  collector:
    conf:
      discovery:
        discoverType: http
        discoverMethod: post_with_body
        pagination:
          type: none
        enableStrictDiscoverParsing: false
        enableDiscoverCode: false
        itemList: []
        discoverUrl: "`https://xxxxxx.audit.cyberark.cloud/api/audits/stream/results`"
        discoverRequestHeaders:
          - name: x-api-key
            value: "#42:qo7ev4hY28zBG3csqoRC+5JOEHW+FVwTtQjUZDTIT/tCOMuVLiA0Zz92MHwy3COvGx2\
              NHeLTz46MTOo17+ZSnA=="
        discoverBody: "{\r

          \    \"query\": {\r

          \    \"pageSize\": 500,\r

          \    \"selectedFields\": [\r

          \      \"tenant_id\",\r

          \      \"custom_data\",\r

          \      \"arrival_timestamp\",\r

          \      \"checksum\",\r

          \      \"application_code\",\r

          \      \"audit_code\",\r

          \      \"timestamp\",\r

          \      \"user_id\",\r

          \      \"session_id\",\r

          \      \"source\",\r

          \      \"action_type\",\r

          \      \"audit_type\",\r

          \      \"component\",\r

          \      \"target\",\r

          \      \"command\",\r

          \      \"message\",\r

          \      \"username\",\r

          \      \"action\",\r

          \      \"uuid\",\r

          \      \"service_name\",\r

          \      \"cloud_roles\",\r

          \      \"cloud_workspaces\",\r

          \      \"cloud_workspaces_and_roles\",\r

          \      \"cloud_assets\",\r

          \      \"cloud_identities\",\r

          \      \"vaulted_accounts\",\r

          \      \"cloud_provider\",\r

          \      \"account_name\",\r

          \      \"target_platform\",\r

          \      \"safe\",\r

          \      \"target_account\",\r

          \      \"identity_type\",\r

          \      \"access_method\",\r

          \      \"account_id\",\r

          \      \"correlation_id\"\r

          \    ],\r

          \    \"filterModel\": {\r

          \      \"date\": {\r

          \        \"dateFrom\": \"2025-10-28 00:00:00\",\r

          \        \"dateTo\": \"2025-10-28 05:00:00\"\r

          \      }\r

          \    },\r

          \    \"sortModel\": [\r

          \      {\r

          \        \"field_name\": \"string\",\r

          \        \"direction\": \"asc\"\r

          \      }\r

          \    ]\r

          \  }\r

          }"
      collectMethod: post_with_body
      pagination:
        type: none
        maxPages: 50
        pageField: page
        sizeField: size
        size: 50
        zeroIndexed: false
        offsetField: offset
        limitField: limit
        limit: 50
        nextRelationAttribute: next
      authentication: oauth
      timeout: 0
      useRoundRobinDns: false
      disableTimeFilter: false
      decodeUrl: false
      rejectUnauthorized: true
      captureHeaders: false
      stopOnEmptyResults: false
      safeHeaders: []
      retryRules:
        type: backoff
        interval: 1000
        limit: 5
        multiplier: 2
        maxIntervalMs: 20000
        codes:
          - 429
          - 503
        enableHeader: true
        retryConnectTimeout: false
        retryConnectReset: false
        retryHeaderName: retry-after
      __scheduling:
        stateTracking: {}
      loginUrl: "`https://acf4417.id.cyberark.cloud/oauth2/token/Cribl`"
      authHeaderKey: Authorization
      authHeaderExpr: "`Bearer ${token}`"
      clientSecretParamName: grant_type
      clientSecretParamValue: "#42:hTq/3uzOhgNWL+yAxs46njSAZ98aNzONJrWVKASFaNjwf1XGrbpGWZJwEHXA1Is6"
      authRequestParams:
        - name: scope
          value: '"isp.audit.events:read"'
      authRequestHeaders:
        - name: Authorization
          value: "#42:l0Nlg5EchyyIRwV6vvVOVm9q9L7eksU98vYMUsa2wuR6OqI78ySTPhQEugGlTMYjJN2\
            J0Ri/JFWkQLA1kla+h+8PdKgcHP49uREzemOVAyrp2u/5Uf5ARo5ulScOjWvdZRdQ95\
            F98+UGraQyzgZiI4jMVU6xKdDciLUmHUxNzLtRUeXFYypkbk2OyH+urCrvAPsIXfi7K\
            ki0gCGRtpUU1w=="
      tokenRespAttribute: access_token
      collectUrl: "`https://acf4417.audit.cyberark.cloud/api/audits/stream/results`"
      collectRequestHeaders:
        - name: x-api-key
          value: "#42:5888k4dJVwmTISbK90cCiCTHQX+Xb+rn+8cSLNYcCJ9aF47IntehO1/RPCLSr0gqQ34\
            HJbCFWQMjb8spiKjhJg=="
      collectBody: 'JSON.parse(`{ "cursorRef" : "${cursorRef}"}`)'
    destructive: false
    encoding: utf8
    type: rest
  input:
    type: collection
    staleChannelFlushMs: 10000
    sendToRoutes: true
    preprocess:
      disabled: true
    throttleRatePerSec: "0"
    breakerRulesets:
      - CyberArk
  savedState: {}
  notifications: []
  description: https://docs.cyberark.com/admin-space/latest/en/content/siem-integration/siem-export-3rd-party.htm
